<!doctype html><title>webaudio.js basic</title>
<script src="../src/webaudio.core.js"></script>
<script src="../src/webaudio.nodechainbuilder.js"></script>
<script src="../src/webaudio.sound.js"></script>
<style>
body {
	margin	: 0px;
	padding	: 0px;
	overflow: hidden;
}
</style>
<body><script>
	var canvas	= document.createElement('canvas');
	canvas.width	= window.innerWidth;
	canvas.height	= window.innerHeight;
	document.body.appendChild(canvas)
	var ctx		= canvas.getContext("2d");  

	// init the library
	var webaudio	= new WebAudio();
	/**
	 * Put this function is .Sound with getByt as private callback
	*/
	var updateBar	= function(){

		var nBar	= 40;
		var histo	= sound.makeHistogram(nBar);

		// clear the canvas
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		ctx.fillStyle	= "rgb(200,0,0)";

		drawHisto(canvas, histo);
		return;

		/**
		 * This could be in image processing too
		*/
		function drawHisto(canvas, histo){
			var nBar	= histo.length;
			var barW	= Math.floor(canvas.width/nBar);
			for(var i = 0; i < histo.length; i++){
				var height	= Math.floor(histo[i]) / 256 * canvas.height;
				ctx.fillRect(i*barW, canvas.height-height, barW, height) ;
			}
		}
	};
	// create a sound
	var url		= 'sounds/techno.mp3';
	//var url		= 'sounds/perfume.mp3';
	var url		= 'sounds/eatpill.mp3'
	var sound	= webaudio.createSound().load(url, function(sound){
		setInterval(function(){
			updateBar();
		}, 1000/60);

		sound.loop(true).play();
	});
</script></body>